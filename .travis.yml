language: nix

sudo: false

env:
  global:
    - CACHIX_CACHE=nikolasm
    - NUR_REPO=n1kolasM/nur-packages
    - secure: "4JUUdaesam3kD+KbV/h0CUnxA6DTeOZouiubffuPKhIfHRKqK+ck0r8boHAEoq73/nGhcA7/bBm9LUehXO7g4BMwF4rV91/dHRFOD99CsactjpX6O4bkKj7d9C7zxx2nyymLop0yssd7kwq4d4d43kPwhYLtaVUxXq7F7iailqT4XJ3IBLxyzupQOK6VsrjaJvMlVS4OhhlKt5w9BNRgc44wkfI5SFJKo1/iFakiC9VJL8naFaIcpIE/oecZyK5nAWU3/41wGn/+h7rtwHEBpdNMMiTby8TL5VZ4Nbw9l+GGIVrauPmJwLkYSMM7fzp9foXDcl5HyiBU8aLKB3zT8uC2PhzkAdXtmSLILviWAxu9W5yf+N0j5X+l8VLBjo9LmyZFRdXKzR4SYkBfSFSlf9iXXdfMmtP4ZQgnD1XDBrYi/kL4KUf9IQ/baCLb1NwlTp/jbsRAfyW/YzyWShapv8B6H2/1BFdrgroKTDXmOWfgkOfVU2qw21jL8M7/xT34ScFjAf6OgLQrhI8c20pX/Eiv853bXCx6RcY9P3s1Ytoc0oGR6HJcRmjWFNEpFS8ygDQ7RgdXIwlLd82r7xWv4d5EsxqPCjDV1+7MZc+tiXA2nSd1QdM/8wSEVrUjr5uB1CWVqQSCSLZ086Ig2dgmr4aOFqTeATFyZa8vhyzHKGg="

matrix:
  include:
    - env: NIX_CHANNEL=https://nixos.org/channels/nixpkgs-unstable
    - env: NIX_CHANNEL=https://nixos.org/channels/nixos-unstable
    - env: NIX_CHANNEL=https://nixos.org/channels/nixos-20.03

install:
 - nix --version
 - if [ -n "${CACHIX_CACHE}" ]; then travis_retry nix-channel --update; fi
 - if [ -n "${CACHIX_CACHE}" ]; then nix-env -iA cachix -f https://cachix.org/api/v1/install; fi
 - if [ -n "${CACHIX_CACHE}" ]; then cachix use "${CACHIX_CACHE}"; fi
 - nix-channel --add "${NIX_CHANNEL}" nixpkgs
 - travis_retry nix-channel --update

script:
 - nix-build ci.nix -A buildOutputs
 - nix eval -f default.nix 'lib'
 - nix eval -f default.nix 'modules'
 - nix eval -f default.nix 'overlays'

after_success:
  - if [ -n "${CACHIX_CACHE}" ]; then nix-build ci.nix -A cacheOutputs | cachix push "${CACHIX_CACHE}"; fi
  - if [ "false" = "${TRAVIS_PULL_REQUEST}" -a "master" = "${TRAVIS_BRANCH}" ]; then
      curl -XPOST "https://nur-update.herokuapp.com/update?repo=${NUR_REPO}"; fi

